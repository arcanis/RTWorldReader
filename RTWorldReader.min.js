(function(t){function e(t,r){if({}.hasOwnProperty.call(e.cache,t))return e.cache[t];var n=e.resolve(t);if(!n)throw new Error("Failed to resolve module "+t);var o={id:t,require:e,filename:t,exports:{},loaded:false,parent:r,children:[]};if(r)r.children.push(o);var i=t.slice(0,t.lastIndexOf("/")+1);e.cache[t]=o.exports;n.call(o.exports,o,o.exports,i,t);o.loaded=true;return e.cache[t]=o.exports}e.modules={};e.cache={};e.resolve=function(t){return{}.hasOwnProperty.call(e.modules,t)?e.modules[t]:void 0};e.define=function(t,r){e.modules[t]=r};var r=function(){var e="/";return{title:"browser",version:"v0.10.5",browser:true,env:{},argv:[],nextTick:t.setImmediate||function(t){setTimeout(t,0)},cwd:function(){return e},chdir:function(t){e=t}}}();e.define("/sources/index.js",function(t,r,n,o){var i=e("/sources/debug.js",t);r.debugMode=i.debugMode.bind(i);var a=e("/sources/loaders.js",t);r.loadBuffer=a.loadBuffer.bind(a);r.loadUrl=a.loadUrl.bind(a);var u=e("/sources/tree.js",t);r.Node=u.Node.bind(u);var s=e("/sources/three.js",t);r.ThreeEntity=s.ThreeEntity.bind(s)});e.define("/sources/three.js",function(t,e,r,n){var o=function(t){switch(t.count()){case 3:return[t];case 4:return[t.slice(0,3),t.slice(2,4).prepend(t.at(0))];default:throw new Error("Invalid vertice number")}};var i=function(t,e){var r=t.children("FACE").children("SUBF").filter(function(t){return t.children("VCNT").prop("content")===e});var n=r.count();var i=e-2;var a=n*i;var u=new THREE.BufferGeometry;u.attributes={index:{itemSize:1,array:new Uint16Array(a*3),numItems:a*3},position:{itemSize:3,array:new Float32Array(a*3*3),numItems:a*3*3},normal:{itemSize:3,array:new Float32Array(a*3*3),numItems:a*3*3}};r.forEach(function(t,e){o(t.children("VERT")).forEach(function(t,r){t.forEach(function(t,n){var o=function(t){return((e*2+r)*3+n)*t.itemSize};var i=t.prop("content");var a=o(u.attributes.index);u.attributes.index.array[a]=a;var s=o(u.attributes.position);u.attributes.position.array[s+0]=i.x;u.attributes.position.array[s+1]=i.y;u.attributes.position.array[s+2]=i.z;var c=o(u.attributes.normal);u.attributes.normal.array[c+0]=i.nx;u.attributes.normal.array[c+1]=i.ny;u.attributes.normal.array[c+2]=i.nz})})});u.dynamic=true;u.offsets=[{start:0,count:a*3,index:0}];u.computeBoundingSphere();return u};e.ThreeEntity=function(t){THREE.Object3D.call(this);t.children("RTWF").children("WRLD").children("ECHI").children("BRSH").children("IFID").forEach(function(e){var r=e.prop("content");var n=t.children("RTWF").children("XTRA").children("BGEO").children("BRSH").filter(function(t){return t.children("IFID").prop("content")===r});if(n.empty())return;var o=new THREE.MeshLambertMaterial({color:"red",wireframe:true,side:THREE.DoubleSide});this.add(new THREE.Mesh(i(n,3),o));this.add(new THREE.Mesh(i(n,4),o))},this)};var a=function(){};a.prototype=typeof THREE!=="undefined"?THREE.Object3D.prototype:{};e.ThreeEntity.prototype=new a});e.define("/sources/tree.js",function(t,e,r,n){var o=function(t){if(t.constructor===o)t=t.array();if(t.constructor!==Array)t=[t];this._set=t;this.flatten()};o.prototype.empty=function(){return this._set.length===0};o.prototype.count=function(){return this._set.length};o.prototype.array=function(){return this._set.slice()};o.prototype.prop=function(t){return this.get()[t]};o.prototype.get=function(t){return this._set[t||0]};o.prototype.at=function(t){return new o(this.get(t))};o.prototype.slice=function(t,e){return new o(this._set.slice(t,e))};o.prototype.forEach=function(t,e){this._set.forEach(function(e,r){t.call(this,new o(e),r)},e||this);return this};o.prototype.map=function(t,e){return new o(this._set.map(function(e,r){return t.call(this,new o(e),r)},e||this))};o.prototype.filter=function(t,e){return new o(this._set.filter(function(e,r){return t.call(this,new o(e),r)},e||this))};o.prototype.flatten=function(){this._set=function t(e,r){e.forEach(function(e){if(e.constructor===o)e=e.array();if(e.constructor===Array){t(e,r)}else{r.push(e)}});return r}(this._set,[]);return this};o.prototype.prepend=function(){this._set=[].concat(Array.prototype.map.call(arguments,function(t){if(t.constructor===o)t=t.array();if(t.construtor!==Array)t=[t];return t}),this._set);return this.flatten()};o.prototype.append=function(t){this._set=[].concat(this._set,Array.prototype.map.call(arguments,function(t){if(t.constructor===o)t=t.array();if(t.construtor!==Array)t=[t];return t}));return this.flatten()};o.prototype.children=function(t){return this.filter(function(t){return t.prop("children")}).map(function(t){return t.prop("children")}).flatten().filter(function(e){return!t||e.prop("label")===t})};o.prototype.descendants=function(){var t=this.children();return t.append(t.map(function(t){return new o(t).descendants()}))};o.prototype.find=function(){var t=Array.prototype.slice.call(arguments);return this.descendants().filter(function(e){return t.indexOf[e.prop("label")]!==-1})};e.Node=o});e.define("/sources/loaders.js",function(t,r,n,o){var i=e("/sources/debug.js",t);var a=e("/sources/dictionaries.js",t);var u=e("/sources/parsers.js",t);var s=e("/sources/tree.js",t);var c=function(t){return String.fromCharCode(t>>0&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>24&255)};var l=function(t,e,r){var n=[],o;for(var a=0;a<r.byteLength;a+=o.fullSize){var s=r.getUint32(a,true);var f=c(s);if(s===0)break;var d=r.getInt32(a+4,true);var p=o={id:s,label:f,size:d,fullSize:d+8,content:null};if(!e.hasOwnProperty(f)){i.warning(t,"Unrecognized label "+f);continue}if(e[f]&&e[f].constructor===Object){i.notice(t,"Entering label "+f);var h=new DataView(r.buffer,r.byteOffset+a+8,r.byteLength-a-8);p.children=l(t.concat([f]),e[f],h);i.notice(t,"Leaving label "+f)}else if(e[f]&&e[f].constructor===String){p.content=u[e[f]](r,a+8,d);i.notice(t,"Parsing "+f+" using "+e[f]+" strategy (gives "+p.content+")")}else{i.notice(t,"Registering "+f+" data");p.content=new DataView(r.buffer,r.byteOffset+a+8,d)}n.push(p)}return n};r.loadBuffer=function(t,e){var r=new DataView(t,0,t.byteLength);var n=l([],a.ROOT,r);e(null,new s.Node({children:n}))};r.loadUrl=function(t,e){var n=new XMLHttpRequest;n.open("GET",t,true);n.responseType="arraybuffer";n.onload=function(t){r.loadBuffer(n.response,e)};n.send(null)}});e.define("/sources/parsers.js",function(t,e,r,n){e.signed=function(t,e,r){return t["getInt"+r*8](e,true)};e.unsigned=function(t,e,r){return t["getUint"+r*8](e,true)};e.float=function(t,e,r){return t["getFloat"+r*8](e,true)};e.boolean=function(t,e,r){return t.getUint8(e)!==0};e.string=function(t,e,r){var n=new ArrayBuffer(r*2);var o=new Uint16Array(n);for(var i=0;i<r;++i)o[i]=t.getUint8(e+i);return String.fromCharCode.apply(String,o)};e.vertice=function(t,e,r){var n={};n.x=t.getFloat64(e,true);e+=8;n.y=t.getFloat64(e,true);e+=8;n.z=t.getFloat64(e,true);e+=8;n.nx=t.getFloat64(e,true);e+=8;n.ny=t.getFloat64(e,true);e+=8;n.nz=t.getFloat64(e,true);e+=8;n.st=t.getFloat64(e,true);e+=8;n.tt=t.getFloat64(e,true);e+=8;n.r=t.getFloat64(e,true);e+=8;n.g=t.getFloat64(e,true);e+=8;n.b=t.getFloat64(e,true);e+=8;n.sl=e<r?t.getFloat64(e,true):null;e+=8;n.tl=e<r?t.getFloat64(e,true):null;e+=8;n.toString=function(){return JSON.stringify(this)};return n}});e.define("/sources/dictionaries.js",function(t,e,r,n){e.ECHI={AENT:{IFID:"unsigned"},BRSH:{IFID:"unsigned",TYPE:"unsigned"},FACE:{IFID:"unsigned",NORX:"float",NORY:"float",NORZ:"float",PLND:"float",TROT:"float",SCAS:"float",SCAT:"float",SHIS:"float",SHIT:"float",COLO:null,TEXN:"string"},PLGT:{IFID:"unsigned",POSX:"float",POSY:"float",POSZ:"float",RADI:"float",COLR:"float",COLG:"float",COLB:"float"},UENT:{IFID:"unsigned",POSX:"float",POSY:"float",POSZ:"float",NAME:"string"}};e.WRLD={IFID:"unsigned",ENAM:"string",HIDE:"boolean",TXPU:"float",NOTS:"boolean",NOTE:"string",LNKS:{FRST:"unsigned",SCND:"unsigned"},ECHI:e.ECHI};e.XTRA={BGEO:{BRSH:{IFID:"unsigned",BFCT:"unsigned",FACE:{TEXN:"string",SFCT:"unsigned",SUBF:{LMID:"signed",VCNT:"unsigned",VERT:"vertice"}}}},TEXD:{TXTR:{TEXN:"string",TWID:"unsigned",THEI:"unsigned",PFMT:"unsigned",DATA:null}}};e.ROOT={RTWF:{VRSN:"unsigned",WRLD:e.WRLD,XTRA:e.XTRA}};e.ECHI.AENT.ECHI=e.ECHI;e.ECHI.BRSH.ECHI={FACE:e.ECHI.FACE}});e.define("/sources/debug.js",function(t,e,r,n){var o=false;e.debugMode=function(t){o=t};var i=function(t,e){return t.map(function(){return"  "}).join("")+e};e.notice=function(t,e){o&&console.info(i(t,e))};e.warning=function(t,e){o&&console.warn(i(t,e))}});t.RTWorldReader=e("/sources/index.js")}).call(this,this);